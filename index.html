<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <title>Tetris Game - Made with Three.js</title>
  
  <!-- Google Fonts: DM Sans -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
  
  <!-- Estilos CSS -->
  <link rel="stylesheet" href="./src/styles/main.css">
  <link rel="stylesheet" href="./src/styles/ui.css">
  <link rel="stylesheet" href="./src/styles/overlays.css">
  
  <!-- MIDI Player Scripts -->
  <script src='./assets/audio/midiplayer/WebAudioFontPlayer.js'></script>
  <script src='./assets/audio/midiplayer/MIDIFile.js'></script>
  <script src='./assets/audio/midiplayer/MIDIPlayer.js'></script>
</head>

<body>
  <!-- Three.js Canvas -->
  <canvas id="game-canvas"></canvas>

  <!-- Flash overlay para efecto visual de bonus -->
  <div id="bonus-flash-overlay"></div>

  <!-- UI OVERLAY: Header + Footer + Pantallas -->
  <div class="ui-overlay">
    <!-- Layout Principal: Header + Espacio + Footer -->
    <div class="game-ui-container">
      <!-- HEADER -->
      <div id="game-header" class="game-header">
        <div class="header-top-section">
          <img src="assets/images/logohygrid.png" alt="Logo HyGrid" class="logo-top">
        </div>
        <div class="color-zones-row">
          <div class="zone zone-red">
            <span class="zone-text">PUBLIC</span>
          </div>
          <div class="zone zone-blue">
            <span class="zone-text">PRIVATE</span>
          </div>
          <div class="zone zone-green">
            <span class="zone-text">ON PREM</span>
          </div>
        </div>
      </div>

      <!-- ESPACIO CENTRAL (para ver Three.js) -->
      <div class="game-scene-spacer"></div>

      <!-- FOOTER -->
      <div id="game-footer" class="game-footer">
        <div class="footer-content">
          <!-- Score -->
          <div class="score-display">
            <div class="score-label">Score</div>
            <div id="score-value" class="score-value score-gray">000000</div>
          </div>

          <!-- Logo con efecto de llenado -->
          <div class="footer-logo">
            <div class="logo-container">
              <img src="./assets/images/union-logo-filled.svg" alt="Logo Base" class="logo-base">
              <div id="logo-fill-wrapper" class="logo-fill-wrapper">
                <img src="./assets/images/union-logo-full.svg" alt="Logo Fill" class="logo-fill">
              </div>
            </div>
          </div>

          <!-- Level -->
          <div class="level-display-footer">
            <div class="level-label-footer">Level</div>
            <div id="level-number-footer" class="level-number-footer">01</div>
          </div>
        </div>
      </div>
    </div>

    <!-- PANTALLAS FULLSCREEN -->
    <div class="overlay-screens">
      <!-- IDLE -->
      <div id="idle-screen" class="screen">
        <img src="./assets/images/logohygrid.png" alt="HyGrid Logo" class="idle-logo">
      </div>

      <!-- INTRO -->
      <div id="intro-screen" class="screen">
        <div class="intro-message">Get Ready!</div>
        <div id="countdown-number" class="countdown">3</div>
      </div>

      <!-- GAME OVER -->
      <div id="gameover-screen" class="screen">
        <div class="gameover-message">GAME OVER</div>
        <div class="final-score">Score: <span id="final-score-value" class="final-score-value">0</span></div>
        <div class="final-lines">Lines: <span id="final-lines-value" class="final-lines-value">0</span></div>
        <div class="restart-hint">Press any key to restart</div>
      </div>

      <!-- SCOREBOARD -->
      <div id="scoreboard-screen" class="screen">
        <div class="scoreboard-title">LEADERBOARD</div>
        <div id="scoreboard-list" class="scoreboard-list"></div>
        <div class="scoreboard-hint">Press any button to play again</div>
        <div class="lighedgefooter">
          <img class="lightedge-logo-full" src="./assets/images/lighedgefooter.svg" alt="LightEdge Footer">
        </div>
      </div>

      <!-- POWER-UP OVERLAY (sin fondo oscuro) -->
      <div id="powerup-overlay" class="screen"></div>

      <!-- LEVEL UP OVERLAY -->
      <div id="levelup-overlay" class="screen"></div>
    </div>
  </div>

  <!-- Control de música por visibilidad del tab -->
  <script>
    var wasMusicPlayingBeforeHide = false;
    
    document.addEventListener('visibilitychange', function() {
      if (document.hidden) {
        // Tab oculto: pausar música
        if (window.midiPlayer && window.musicStarted) {
          wasMusicPlayingBeforeHide = true;
          window.pauseMusic();
        }
      } else {
        // Tab visible: reanudar música si estaba sonando
        if (wasMusicPlayingBeforeHide) {
          window.startMusic();
          wasMusicPlayingBeforeHide = false;
        }
      }
    });
  </script>

  <!-- Cargar controladores y aplicación principal -->
  <script type="module" src="./src/ui/UIController.js"></script>
  <script type="module" src="./src/audio/AudioController.js"></script>
  <script type="module" src="./src/main.js"></script>
</body>
</html>
