<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <title>Cloud Stacker by LightEdge</title>
  
  <!-- Import map so example modules can resolve the bare 'three' specifier in the browser -->
  <script type="importmap">
    {
      "imports": {
        "three": "./src/three/three.module.js"
      }
    }
  </script>

  <!-- Google Fonts: DM Sans -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
  
  <!-- Estilos CSS -->
  <link rel="stylesheet" href="./src/styles/main.css">
  <link rel="stylesheet" href="./src/styles/ui.css">
  <link rel="stylesheet" href="./src/styles/overlays.css">
  
  <!-- MIDI Player Scripts -->
  <script src='./assets/audio/midiplayer/WebAudioFontPlayer.js'></script>
  <script src='./assets/audio/midiplayer/MIDIFile.js'></script>
  <script src='./assets/audio/midiplayer/MIDIPlayer.js'></script>
</head>

<body>
  <!-- Three.js Canvas -->
  <canvas id="game-canvas"></canvas>

  <!-- Flash overlay para efecto visual de bonus -->
  <div id="bonus-flash-overlay"></div>

  <!-- UI OVERLAY: Header + Footer + Pantallas -->
  <div class="ui-overlay">
    <!-- Layout Principal: Header + Espacio + Footer -->
    <div class="game-ui-container">
      <!-- HEADER -->
      <div id="game-header" class="game-header">
        <div class="header-top-section">
          <div class="header-logo-container">
            <img src="assets/images/logo-header.png" alt="Cloud Stacker" class="logo-top">
          </div>
          <div id="next-piece-container" class="next-piece-container">
            <div class="next-piece-label">Next</div>
            <div id="next-piece-preview" class="next-piece-preview"></div>
          </div>
        </div>
        <div class="color-zones-row">
          <div class="zone zone-red">
            <span class="zone-text">PUBLIC</span>
          </div>
          <div class="zone zone-blue">
            <span class="zone-text">PRIVATE</span>
          </div>
          <div class="zone zone-green">
            <span class="zone-text">ON PREM</span>
          </div>
        </div>
      </div>

      <!-- ESPACIO CENTRAL (para ver Three.js) -->
      <div class="game-scene-spacer"></div>

      <!-- FOOTER -->
      <div id="game-footer" class="game-footer">
        <div class="footer-content">
          <!-- Score -->
          <div class="score-display">
            <div class="score-label">Score</div>
            <div id="score-value" class="score-value score-gray">000000</div>
          </div>

          <!-- Lines + Level section -->
          <div class="lines-level-display-footer">
            <div class="lines-display-footer">
              <div class="lines-label-footer">Lines</div>
              <div id="lines-number-footer" class="lines-number-footer">00</div>
            </div>
            <div class="level-display-footer">
              <div class="level-label-footer">Level</div>
              <div id="level-number-footer" class="level-number-footer">01</div>
            </div>
          </div>

          <!-- Logo con efecto de llenado -->
          <div class="footer-logo">
            <div class="logo-container">
              <img src="./assets/images/union-logo-outline.svg" alt="Logo Base" class="logo-base">
              <div id="logo-fill-wrapper" class="logo-fill-wrapper">
                <img src="./assets/images/union-logo-filled.svg" alt="Logo Fill" class="logo-fill">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PANTALLAS FULLSCREEN -->
    <div class="overlay-screens">
      <!-- IDLE -->
      <div id="idle-screen" class="screen">
        <img src="./assets/images/logo.png" alt="Cloud Stacker" class="idle-logo">
      </div>

      <!-- INTRO -->
      <div id="intro-screen" class="screen">
        <div class="intro-message">Get Ready!</div>
        <div id="countdown-number" class="countdown">3</div>
      </div>

      <!-- GAME OVER -->
      <div id="gameover-screen" class="screen">
        <div class="gameover-message">GAME<br>OVER</div>
      </div>

      <!-- NAME INPUT SCREEN (after GAME OVER) -->
      <div id="name-input-screen" class="screen solid-bg">
        <div class="overlay-top-title"><img src="./assets/images/logo.png" alt="Cloud Stacker" class="overlay-top-logo"></div>
        <div class="name-input-title">Enter your name</div>
        <div class="name-input-container">
          <div class="letter-selector" data-position="0">
            <div class="letter-value">A</div>
            <div class="letter-arrows">
              <span class="arrow-up">▲</span>
              <span class="arrow-down">▼</span>
            </div>
          </div>
          <div class="letter-selector" data-position="1">
            <div class="letter-value">A</div>
            <div class="letter-arrows">
              <span class="arrow-up">▲</span>
              <span class="arrow-down">▼</span>
            </div>
          </div>
          <div class="letter-selector" data-position="2">
            <div class="letter-value">A</div>
            <div class="letter-arrows">
              <span class="arrow-up">▲</span>
              <span class="arrow-down">▼</span>
            </div>
          </div>
        </div>
        <div class="name-input-hint">↑↓ Change Letter | ←→ Move/Confirm</div>
        <div class="final-stats-box">
          <div class="final-score">Score<span id="final-score-value" class="final-score-value">0</span></div>
          <div class="final-lines">Lines<span id="final-lines-value" class="final-lines-value">0</span></div>
        </div>
      </div>

      <!-- SCOREBOARD -->
      <div id="scoreboard-screen" class="screen solid-bg">
        <div class="overlay-top-title"><img src="./assets/images/logo.png" alt="Cloud Stacker" class="overlay-top-logo"></div>
        <div id="scoreboard-list" class="scoreboard-list"></div>
        <div class="scoreboard-hint">Press any button to play again</div>
        <div class="lighedgefooter">
          <img class="lightedge-logo-full" src="./assets/images/lighedgefooter.svg" alt="LightEdge Footer">
        </div>
      </div>

      <!-- POWER-UP OVERLAY (sin fondo oscuro) -->
      <div id="powerup-overlay" class="screen"></div>

      <!-- LEVEL UP OVERLAY -->
      <div id="levelup-overlay" class="screen"></div>
    </div>
  </div>

  <!-- Control de música por visibilidad del tab -->
  <script>
    var wasMusicPlayingBeforeHide = false;
    
    document.addEventListener('visibilitychange', function() {
      if (document.hidden) {
        // Tab oculto: pausar música
        if (window.midiPlayer && window.musicStarted) {
          wasMusicPlayingBeforeHide = true;
          window.pauseMusic();
        }
      } else {
        // Tab visible: reanudar música si estaba sonando
        if (wasMusicPlayingBeforeHide) {
          window.startMusic();
          wasMusicPlayingBeforeHide = false;
        }
      }
    });
  </script>

  <!-- Cargar controladores y aplicación principal -->
  <script type="module" src="./src/ui/UIController.js"></script>
  <script type="module" src="./src/audio/AudioController.js"></script>
  <script type="module" src="./src/main.js"></script>
</body>
</html>
